#NoEnv  
#Persistent
#NoTrayIcon
DetectHiddenWindows, on
SetBatchLines, -1
ListLines, off

NetConnectionID()
{
    for objItem in ComObjGet("winmgmts:\\.\root\CIMV2").ExecQuery("SELECT * FROM Win32_NetworkAdapter WHERE DeviceID = 1").ExecQuery("SELECT * FROM Win32_NetworkAdapter WHERE DeviceID = 2")
            if (objItem.DeviceID = 1 && 2)
            {
                return, % {1 : ObjItem.NetConnectionID[0]},{2 : ObjItem.NetConnectionID[0]}
            }
}
for objItem in ComObjGet("winmgmts:\\.\root\CIMV2").ExecQuery("SELECT * FROM Win32_NetworkAdapter WHERE DeviceID = 1 ")
     for objItem in ComObjGet("winmgmts:\\.\root\CIMV2").ExecQuery("SELECT * FROM Win32_NetworkAdapter WHERE DeviceID = 2")
{
    if (objItem.DeviceID = 1 ) 
        {
           NicName := objItem.NetConnectionID[0]
        }
        else (objItem.DeviceID =  2) 
        {
           NicName2 := objItem.NetConnectionID[0]
        }
}

GroupAdd, NetAccess, ahk_exe firefox.exe
GroupAdd, NetAccess, ahk_exe TRANSM~1.EXE
GroupAdd, NetAccess, ahk_exe vlc.exe
GroupAdd, NetAccess,  ahk_exe  NetworkMiner.ex

CheckRun = 0

Settimer, AdapterActivity, 500
Return

AdapterActivity:
IfWinExist, ahk_Group NetAccess
{
    if CheckRun = 0 
    {
        run, %comspec% /c netsh.exe interface set interface name=%NicName2% admin=Enable, %SystemRoot%\System32\,Hide
        CheckRun++
    }
    else
    {
        return
    }
}
IfWinNotExist, ahk_Group NetAccess
{
    if CheckRun = 1
    {
        run, %comspec% /c netsh.exe interface set interface name=%NicName2% admin=Disable, %SystemRoot%\System32\,Hide
        CheckRun--
    }
    else
    {
        return
    }
}
return
