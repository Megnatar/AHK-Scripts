#NoEnv  
#Persistent
#NoTrayIcon
SetTitleMatchMode, 1
SetTitleMatchMode, RegEx
DetectHiddenWindows, on
SetBatchLines, -1
ListLines, off

for objItem in ComObjGet("winmgmts:\\.\root\CIMV2").ExecQuery("SELECT * FROM Win32_NetworkAdapter WHERE PhysicalAdapter  = True")
{
        if (objItem.PNPDeviceID != "ROOT\NET\0000")
            {
                NicName := objItem.NetConnectionID[0]
                Interface_ID := objItem.DeviceID
            }
    NicToToggle = "%Nicname%"
}

objWMIService := ComObjGet("winmgmts:\\" & strComputer & "\root\CIMV2")
objStatToggle := objWMIService.ExecMethod("Win32_NetworkAdapter.DeviceID='" Interface_ID "'","Disable")

GroupAdd, NetAccess, ahk_exe firefox.exe
GroupAdd, NetAccess, ahk_exe iexplore.exe
GroupAdd, NetAccess, Windows Update ahk_exe Explorer.exe
;Change VLC option --input-title-format $Z  to --input-title-format $t $g $p 
GroupAdd, NetAccess, Radio .* ahk_exe vlc.exe

AdapterActive:
IfWinNotExist, ahk_Group NetAccess
{
    if (CheckRun >= 1)
    {
        Settimer, AdapterActive, off
        objWMIService := ComObjGet("winmgmts:\\" & strComputer & "\root\CIMV2")
        objStatToggle := objWMIService.ExecMethod("Win32_NetworkAdapter.DeviceID='" Interface_ID "'","Disable")
        CheckRun--
        Settimer, AdapterNotActive, on
    }
}
if (CheckRun = "")
{ 
    Settimer, AdapterNotActive, 1000
}
return

AdapterNotActive:
IfWinExist, ahk_Group NetAccess
{
    if (CheckRun = "" || CheckRun >= 0 )
    {
        Settimer, AdapterNotActive, off
        objWMIService := ComObjGet("winmgmts:\\" & strComputer & "\root\CIMV2")
        objStatToggle := objWMIService.ExecMethod("Win32_NetworkAdapter.DeviceID='" Interface_ID "'","Enable")
        CheckRun++
    }
if (CheckRun >= 1)
    {
        Settimer, AdapterActive, 1000
    }
}
return
