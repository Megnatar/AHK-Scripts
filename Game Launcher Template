/* 
Two scripts for launching a game or application. The first is using SetTimer for closing the script once the
application quits. The Second script does the exect same thing but simply waits for the programe/process
to close, thus it's much faster. Variables are blank and they need to be specified, but Process_ID will 
be assigned by the script. Use SendEvent or SendPlay for sending key's. SetKeyDelay might need some adjustments
when the key's are not triggerd by you're application. Timing is very important!
*/
;////////////////////////Using settimer for terminating script when application closes////////////////////////

;--------------------------AutoExecute Section--------------------------
#NoEnv  
#SingleInstance, force
SetKeyDelay, 10, 10
SetWorkingDir %A_ScriptDir% 
SetBatchLines,-1 
ListLines, off 
detectHiddenWindows, on

GameExe = 
GamePath =
Process_ID = ""

GroupAdd, ForThisWinOnly, ahk_exe %GameExe%  ;The #IfWin directive doesn't support variable names. Workaround 

IfWinExist, ahk_exe %GameExe%
{   
    WinActivate, ahk_exe %GameExe%
    WinGet, Process_ID, PID, ahk_exe %GameExe% 
} 
Else 
If WinNotExist ahk_exe %GameExe%
{
    run,%GameExe%, %GamePath%,,Process_ID   
}

SetTimer ChkProcess, 5000                   ;5 second period for checking process to close
Return

;--------------------------AutoExecute Section End--------------------------

#IfWinActive, ahk_group ForThisWinOnly
{
                                            ;Actions will go here
}
                    
ChkProcess:                                 ;Close script when process isn't active anymore
Process, Exist, %Process_ID%
If ErrorLevel = 0
Exitapp
Return


;////////////////////////Or Without the use of settimer////////////////////////

;--------------------------AutoExecute Section--------------------------
#NoEnv  
#SingleInstance, force
SetKeyDelay, 10, 10
SetWorkingDir, %A_ScriptDir%
SetBatchLines, -1
detectHiddenWindows, on
ListLines, off

GameExe = 
GamePath = 
WinTitle = 
Process_ID = ""
bAutorun = 0

GroupAdd, ForThisWinOnly, %WinTitle%
GroupAdd, ForThisWinOnly, ahk_exe %GameExe%

IfWinNotExist, ahk_exe %GameExe%
{
    run,%GameExe%, %GamePath%,,Process_ID
    Process, WaitClose, %Process_ID%		;This thread keeps running and waits here for process to close
    ExitApp
}
else
IfWinExist, ahk_exe %GameExe%
{
    WinActivate, ahk_exe %GameExe%
    WinGet, Process_ID, PID, ahk_exe %GameExe%
    Process, WaitClose, %Process_ID%
    ExitApp
}
#IfWinExist, ahk_group ForThisWinOnly
#IfWinActive, ahk_group ForThisWinOnly
{

Xbutton1::                                      ;Togglekey. Autorun when eighter of the two thumb buttons are pressed once.
Xbutton2::
If (bAutorun = 0) {
    SendEvent, {w down}
    bAutorun++
}Else{
    SendEvent, {w up}
    bAutorun--
}
Return

~Lbutton::
SendEvent, {w up}
bAutorun = 0

keywait, Lbutton, T0.25                         ;Left mouse click is down as long as the leftbutton is pressed.
if errorlevel = 1 
{
    while GetKeyState("Lbutton", "P") 
    {
        SendEvent, {click down}
        keywait, Lbutton
        SendEvent, {click up}
    } 
return
}
else
keywait, Lbutton, D T0.25                    	;Shift is down when left button is clicked twice and then pressed down.
if errorlevel = 0          
{
    	SendEvent, {Shift down}
	KeyWait, Lbutton
	SendEvent, {Shift up}
    return               
 }
}
