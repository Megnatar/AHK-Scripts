if not A_IsAdmin
{
        Run *RunAs "%A_ScriptFullPath%"
        ExitApp
}
#NoEnv  
#Persistent
#SingleInstance off
DetectHiddenWindows, on
SetWorkingDir %A_ScriptDir% 
SetBatchLines, -1
SetWinDelay, -1
ListLines, off
for objItem in ComObjGet("winmgmts:\\.\root\CIMV2").ExecQuery("SELECT * FROM Win32_NetworkAdapter WHERE PhysicalAdapter  = True")
{
        if (objItem.PNPDeviceID != "ROOT\NET\0000")
        {
                Interface_ID := objItem.DeviceID
        }
        objWMIServiceDisable := ComObjGet("winmgmts:\\" & strComputer & "\root\CIMV2").ExecMethod("Win32_NetworkAdapter.DeviceID='" Interface_ID "'","Disable")
        Menu, tray, Icon,
        Menu, tray, Icon, %A_WinDir%\system32\pnidui.dll,1
}
IfnotExist, %A_ScriptDir%\NetAccess.acc
{
        FileAppend, ahk_exe firefox.exe, %A_ScriptDir%\NetAccess.acc
}
Settimer, EnableAdapter, 700
Menu, tray, Icon
Menu, Tray, NoStandard
Menu, tray, add, Adaper settings, Settings
Menu, tray, add
Menu, tray, add, Enable this network device, TurnOn
Menu, tray, add, Disable this network device, TurnOff
Menu, tray, add
Menu, tray, add, Exit, CloseScript
return
EnableAdapter:
Loop, read, %A_ScriptDir%\NetAccess.acc
{
        Loop, parse, A_LoopReadLine, %A_Tab%
        {
            GroupAdd, NetAccess, %A_LoopField%
        }
}
IfWinExist, ahk_Group NetAccess
{
        Settimer, EnableAdapter, off
        objWMIServiceEnable := ComObjGet("winmgmts:\\" & strComputer & "\root\CIMV2").ExecMethod("Win32_NetworkAdapter.DeviceID='" Interface_ID "'","Enable")
        Menu, tray, Icon,
        Menu, tray, Icon, %A_WinDir%\system32\pnidui.dll,13
        Settimer, DisableAdapter, 700
}
return
DisableAdapter:
IfWinNotExist, ahk_Group NetAccess
{
        Settimer, DisableAdapter, off
        objWMIServiceDisable := ComObjGet("winmgmts:\\" & strComputer & "\root\CIMV2").ExecMethod("Win32_NetworkAdapter.DeviceID='" Interface_ID "'","Disable")
        Menu, tray, Icon
        Menu, tray, Icon, %A_WinDir%\system32\pnidui.dll,1
        Settimer, EnableAdapter, 700
}
return
TurnOn:
Menu, tray, Icon
Menu, tray, Icon, %A_WinDir%\system32\pnidui.dll,13
objWMIServiceEnable := ComObjGet("winmgmts:\\" & strComputer & "\root\CIMV2").ExecMethod("Win32_NetworkAdapter.DeviceID='" Interface_ID "'","Enable")
Return
TurnOff:
Menu, tray, Icon,
Menu, tray, Icon,  %A_WinDir%\system32\pnidui.dll,1
objWMIServiceDisable := ComObjGet("winmgmts:\\" & strComputer & "\root\CIMV2").ExecMethod("Win32_NetworkAdapter.DeviceID='" Interface_ID "'","Disable")
return
Settings:
Run, %A_WinDir%\explorer.exe shell:::{26EE0668-A00A-44D7-9371-BEB064C98683}\3\::{7007ACC7-3202-11D1-AAD2-00805FC1270E}
return
CloseScript:
ExitApp
