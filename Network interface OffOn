#NoEnv  
#Persistent
#NoTrayIcon
SetWorkingDir %A_ScriptDir% 
DetectHiddenWindows, on
SetBatchLines, -1
ListLines, off

NetConnectionID()
{
    for objItem in ComObjGet("winmgmts:\\.\root\CIMV2").ExecQuery("SELECT * FROM Win32_NetworkAdapter WHERE DeviceID = 1")
    {
        if (objItem.DeviceID = 1 )
        {
            return, % {1 :ObjItem.NetConnectionID[0]}
        }
    }
}

for objItem in ComObjGet("winmgmts:\\.\root\CIMV2").ExecQuery("SELECT * FROM Win32_NetworkAdapter WHERE DeviceID = 1")
{
      if (objItem.DeviceID = 1 ) {
        NicName := objItem.NetConnectionID[0]
      }
}

If NicName is not number
{
    IniWrite, %NicName%, settings.ini, AdpterSettins, NetConnectionID
    RunWait, %comspec% /c netsh.exe interface set interface name=%NicName% admin=Disable, %SystemRoot%\System32\,Hide 
}
if NicName is number
{   
    Nicname =
    iniread, NicName, Settings.ini, AdpterSettins, NetConnectionID
    runwait, %comspec% /c netsh.exe interface set interface name=%NicName%  admin=Enable, %SystemRoot%\System32\,Hide
}

GroupAdd, NetAccess, ahk_class MozillaWindowClass
GroupAdd, NetAccess, ahk_class MozillaDialogClass
GroupAdd, NetAccess, Windows Update 
GroupAdd, NetAccess, AutoHotkey Setup
GroupAdd, NetAccess, SciTE4AutoHotkey Updater ahk_exe InternalAHK.exe
GroupAdd, NetAccess, ahk_class QWidget      
GroupAdd, NetAccess, Extensions and Updates ahk_exe devenv.exe

SetTimer, ChkAppRunning, 100
return

ChkAppRunning:
IfWinNotExist, ahk_group NetAccess
return
IfWinExist, ahk_group NetAccess
{
	runwait, %comspec% /c netsh.exe interface set interface name=%NicName% admin=Enable, %SystemRoot%\System32\,Hide
	WinWaitClose, ahk_group NetAccess
	IfWinNotExist, ahk_group NetAccess
	runwait, %comspec% /c netsh.exe interface set interface name=%NicName% admin=Disable, %SystemRoot%\System32\,Hide
}
return
